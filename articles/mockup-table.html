<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create Mockup Table Based on Metadata • metalite</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Create Mockup Table Based on Metadata">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">metalite</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/metalite.html">Get Started</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Merck/metalite/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Create Mockup Table Based on Metadata</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Merck/metalite/blob/main/vignettes/mockup-table.Rmd" class="external-link"><code>vignettes/mockup-table.Rmd</code></a></small>
      <div class="d-none name"><code>mockup-table.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/metalite/">metalite</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://merck.github.io/r2rtf/" class="external-link">r2rtf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<p>In this document, we illustrate a way to create mockup table by using
the metadata created by metalite. An easy-to-follow example is used for
illustration purpose. If users want to get a comprehensive production
ready work, then users need to refine this simple example to align with
their cases.</p>
<div class="section level2">
<h2 id="overview-of-the-example-we-used">Overview of the example we used<a class="anchor" aria-label="anchor" href="#overview-of-the-example-we-used"></a>
</h2>
<p>In this example, the available datasets are adae and adsl, which are
available in the r2rtf package, i.e., <code><a href="https://merck.github.io/r2rtf/reference/r2rtf_adae.html" class="external-link">r2rtf::r2rtf_adae</a></code> and
<code><a href="https://merck.github.io/r2rtf/reference/r2rtf_adsl.html" class="external-link">r2rtf::r2rtf_adsl</a></code>. For these two datasets, our objective is
to conduct two adverse event (AE) analysis: (1) AE summary analysis and
(3) specific AE analysis. And the population for these two analysis is
all participants as treated (APaT). Besides, there is one observations
for these two analysis: weeks 0-12. In the analysis, we are interested
in three types of AEs: (1) any AEs, (2) series AEs, and (3) drug-related
AEs.</p>
<p>Please note the above example servers for illustration purpose,
instead of a comprehensive production ready work. If users are
interested in more AE analysis with more AE categories, or get more
types of populations/observations, modification of code in this vignette
is needed.</p>
</div>
<div class="section level2">
<h2 id="prepare-the-metadata">Prepare the metadata<a class="anchor" aria-label="anchor" href="#prepare-the-metadata"></a>
</h2>
<p>In this section, we introduce the steps to prepare the metadata used
for the aforementioned two AE analysis.</p>
<div class="section level3">
<h3 id="step-1-define-the-metadata">Step 1: Define the metadata<a class="anchor" aria-label="anchor" href="#step-1-define-the-metadata"></a>
</h3>
<p>To define the metadata, users need to specify both population and
observations datasets. In our example, the observation dataset comes
from <code><a href="https://merck.github.io/r2rtf/reference/r2rtf_adae.html" class="external-link">r2rtf::r2rtf_adae</a></code> and the population dataset comes
from <code><a href="https://merck.github.io/r2rtf/reference/r2rtf_adsl.html" class="external-link">r2rtf::r2rtf_adsl</a></code>. So we define the metadata by
<code><a href="../reference/meta_adam.html">meta_adam()</a></code> as follows, where users can specify the
observation dataset name and population dataset name.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">adae</span> <span class="op">&lt;-</span> <span class="fu">r2rtf</span><span class="fu">::</span><span class="va"><a href="https://merck.github.io/r2rtf/reference/r2rtf_adae.html" class="external-link">r2rtf_adae</a></span></span>
<span><span class="va">adsl</span> <span class="op">&lt;-</span> <span class="fu">r2rtf</span><span class="fu">::</span><span class="va"><a href="https://merck.github.io/r2rtf/reference/r2rtf_adsl.html" class="external-link">r2rtf_adsl</a></span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>TRTA <span class="op">=</span> <span class="va">TRT01A</span><span class="op">)</span></span>
<span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/meta_adam.html">meta_adam</a></span><span class="op">(</span></span>
<span>  observation <span class="op">=</span> <span class="va">adae</span>,</span>
<span>  population <span class="op">=</span> <span class="va">adsl</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-2-define-the-analysis-plan">Step 2: Define the analysis plan<a class="anchor" aria-label="anchor" href="#step-2-define-the-analysis-plan"></a>
</h3>
<p>To start mockup tables, we begin with defining the mockup analysis
plan. To define an analysis plan, we use <code><a href="../reference/plan.html">plan()</a></code> and
<code><a href="../reference/add_plan.html">add_plan()</a></code> to add details per one <strong>mockup</strong>
analysis.</p>
<p>Recall in this example, we have 2 analysis plans:</p>
<ul>
<li>AE summary;</li>
<li>Specific AE analysis.</li>
</ul>
<p>For the AE summary analysis, we will define
<code>analysis = "ae_summary"</code>. Similarly we define proper
population, observation and parameter key words for</p>
<ul>
<li>
<code>population = "apat"</code>: All Participants as Treated
(APaT).</li>
<li>
<code>observation = "wk12"</code>: Weeks 0-12 analyses.</li>
<li>
<code>parameter = "any;rel;ser"</code>: a table to cover “any”,
“drug related” and “serious” adverse events.</li>
</ul>
<p>For the AE specific analysis, users can follow the similar logic as
in AE summary.</p>
<p>So, we can define an analysis plan as below for a total of 2 mockup
to generate 4 TLFs.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plan.html">plan</a></span><span class="op">(</span></span>
<span>  analysis <span class="op">=</span> <span class="st">"ae_summary"</span>, population <span class="op">=</span> <span class="st">"apat"</span>,</span>
<span>  observation <span class="op">=</span> <span class="st">"wk12"</span>, parameter <span class="op">=</span> <span class="st">"any;rel;ser"</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/add_plan.html">add_plan</a></span><span class="op">(</span></span>
<span>    analysis <span class="op">=</span> <span class="st">"ae_specific"</span>, population <span class="op">=</span> <span class="st">"apat"</span>,</span>
<span>    observation <span class="op">=</span> <span class="st">"wk12"</span>,</span>
<span>    parameter <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"any"</span>, <span class="st">"rel"</span>, <span class="st">"ser"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">plan</span></span>
<span><span class="co">#&gt;   mock    analysis population observation   parameter</span></span>
<span><span class="co">#&gt; 1    1  ae_summary       apat        wk12 any;rel;ser</span></span>
<span><span class="co">#&gt; 2    2 ae_specific       apat        wk12         any</span></span>
<span><span class="co">#&gt; 3    2 ae_specific       apat        wk12         rel</span></span>
<span><span class="co">#&gt; 4    2 ae_specific       apat        wk12         ser</span></span></code></pre></div>
<p>Then, we use incorporate the above defined plan into the metadata by
using <code><a href="../reference/define_plan.html">define_plan()</a></code>, i.e.,</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/define_plan.html">define_plan</a></span><span class="op">(</span><span class="va">plan</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-3-define-the-keywords">Step 3: Define the keywords<a class="anchor" aria-label="anchor" href="#step-3-define-the-keywords"></a>
</h3>
<p>After defining the overview of the analysis plan, we begin to define
the meaning of key words.</p>
<p><strong>Define keywords in population:</strong></p>
<p>The following code define the keywords <code>"apat"</code>, which is
a population keywords for APaT population. And here we also cover the
key information such as group variable, the group order, etc…</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_population.html">define_population</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"apat"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>    group_order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"High Dose"</span> <span class="op">=</span> <span class="st">"Xanomeline High Dose"</span>,</span>
<span>      <span class="st">"Placebo"</span> <span class="op">=</span> <span class="st">"Placebo"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    subset <span class="op">=</span> <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Define keywords in observation:</strong></p>
<p>The following code define the keywords <code>"wk12"</code>, which is
an observation keywords for Weeks 0-12 observations.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_observation.html">define_observation</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"wk12"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"TRTA"</span>,</span>
<span>    ae_var <span class="op">=</span> <span class="st">"AEDECOD"</span>,</span>
<span>    var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AEREL"</span>, <span class="st">"AESER"</span><span class="op">)</span>,</span>
<span>    subset <span class="op">=</span> <span class="va">SAFFL</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Weeks 0 to 12"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><strong>Define keywords in analysis plans:</strong></p>
<p>Note that in the analysis plan, there are 5 keywords:</p>
<ul>
<li>
<code>"any"</code>: a parameter keywords for any adverse
events.</li>
<li>
<code>"rel"</code>: a parameter keywords for drug-related adverse
events.</li>
<li>
<code>"ser"</code>: a parameter keywords for serious adverse
events.</li>
<li>
<code>"ae_summary"</code>: an analysis keywords for AE summary
analysis.</li>
<li>
<code>"ae_specific"</code>: an analysis keywords for specific AE
analysis.</li>
</ul>
<p>For the first three keywords, we can define them by
<code><a href="../reference/define_parameter.html">define_parameter()</a></code> as follows. Here we can add (1) the
endnotes, (2) labels, (3) the criterion to filter, etc.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_parameter.html">define_parameter</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"any"</span>,</span>
<span>    end_notes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_parameter.html">define_parameter</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"rel"</span>,</span>
<span>    subset <span class="op">=</span> <span class="va">AEREL</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"POSSIBLE"</span>, <span class="st">"PROBABLE"</span><span class="op">)</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"drug-realted adverse events"</span></span>
<span>  <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_parameter.html">define_parameter</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"ser"</span>,</span>
<span>    subset <span class="op">=</span> <span class="va">AESER</span> <span class="op">==</span> <span class="st">"Y"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"serious adverse events"</span>,</span>
<span>    end_notes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Serious adverse events up to 90 days of last dose are included."</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>For the last two keywords, we can define them by
<code><a href="../reference/define_analysis.html">define_analysis()</a></code>. In this vignette, we only present the
mockup table of AE summary. If users are interested in specific AE
analysis, please define the keywords for <code>"ae_specific"</code> as
<code>define_analysis(name = "ae_specific", title = ...)</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/define_analysis.html">define_analysis</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="st">"ae_summary"</span>,</span>
<span>    title <span class="op">=</span> <span class="st">"Summary of Adverse Events"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step-4-build-and-review-the-metadata">Step 4: Build and review the metadata<a class="anchor" aria-label="anchor" href="#step-4-build-and-review-the-metadata"></a>
</h3>
<p>Once all keywords, datasets, analysis plan are defined, users can
build the metadata to compose all the information.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span> <span class="op">&lt;-</span> <span class="va">meta</span> <span class="op">|&gt;</span> <span class="fu"><a href="../reference/meta_build.html">meta_build</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>After the entire metadata is built, users can review the analysis
plan by</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span><span class="op">$</span><span class="va">plan</span></span>
<span><span class="co">#&gt;   mock    analysis population observation   parameter</span></span>
<span><span class="co">#&gt; 1    1  ae_summary       apat        wk12 any;rel;ser</span></span>
<span><span class="co">#&gt; 2    2 ae_specific       apat        wk12         any</span></span>
<span><span class="co">#&gt; 3    2 ae_specific       apat        wk12         rel</span></span>
<span><span class="co">#&gt; 4    2 ae_specific       apat        wk12         ser</span></span></code></pre></div>
<p>And the entire meta is</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span></span>
<span><span class="co">#&gt; ADaM metadata: </span></span>
<span><span class="co">#&gt;    .$data_population     Population data with 254 subjects </span></span>
<span><span class="co">#&gt;    .$data_observation    Observation data with 1191 records </span></span>
<span><span class="co">#&gt;    .$plan    Analysis plan with 4 plans </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Analysis population type:</span></span>
<span><span class="co">#&gt;     name        id  group var       subset                         label</span></span>
<span><span class="co">#&gt; 1 'apat' 'USUBJID' 'TRTA'     SAFFL == 'Y' 'All Participants as Treated'</span></span>
<span><span class="co">#&gt;                     group_order</span></span>
<span><span class="co">#&gt; 1 Xanomeline High Dose, Placebo</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Analysis observation type:</span></span>
<span><span class="co">#&gt;     name        id  group          var       subset           label    ae_var</span></span>
<span><span class="co">#&gt; 1 'wk12' 'USUBJID' 'TRTA' AEREL, AESER SAFFL == 'Y' 'Weeks 0 to 12' 'AEDECOD'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Analysis parameter type:</span></span>
<span><span class="co">#&gt;    name                         label                               subset</span></span>
<span><span class="co">#&gt; 1 'any'          'any adverse events'                                     </span></span>
<span><span class="co">#&gt; 2 'rel' 'drug-realted adverse events' AEREL %in% c('POSSIBLE', 'PROBABLE')</span></span>
<span><span class="co">#&gt; 3 'ser'      'serious adverse events'                         AESER == 'Y'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   Analysis function:</span></span>
<span><span class="co">#&gt;            name                           label</span></span>
<span><span class="co">#&gt; 1  'ae_summary'  'Table: adverse event summary'</span></span>
<span><span class="co">#&gt; 2 'ae_specific' 'Table: specific adverse event'</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="add-components-of-mockup-table">Add components of mockup table<a class="anchor" aria-label="anchor" href="#add-components-of-mockup-table"></a>
</h2>
<p>Based on the mockup table, we specify additional parameters that are
required in the function we will define in the next section.</p>
<ul>
<li>
<code>mockup = TRUE</code> as we will create mockup for both
analysis.</li>
<li>
<code>output_report</code> to define the output path based on
<code>analysis</code> keywords.</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">meta</span><span class="op">$</span><span class="va">plan</span> <span class="op">&lt;-</span> <span class="va">meta</span><span class="op">$</span><span class="va">plan</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    mockup <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    output_report <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"./tlf/mock-"</span>, <span class="va">analysis</span>, <span class="st">".rtf"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">meta</span><span class="op">$</span><span class="va">plan</span></span>
<span><span class="co">#&gt;   mock    analysis population observation   parameter mockup</span></span>
<span><span class="co">#&gt; 1    1  ae_summary       apat        wk12 any;rel;ser   TRUE</span></span>
<span><span class="co">#&gt; 2    2 ae_specific       apat        wk12         any   TRUE</span></span>
<span><span class="co">#&gt; 3    2 ae_specific       apat        wk12         rel   TRUE</span></span>
<span><span class="co">#&gt; 4    2 ae_specific       apat        wk12         ser   TRUE</span></span>
<span><span class="co">#&gt;                output_report</span></span>
<span><span class="co">#&gt; 1  ./tlf/mock-ae_summary.rtf</span></span>
<span><span class="co">#&gt; 2 ./tlf/mock-ae_specific.rtf</span></span>
<span><span class="co">#&gt; 3 ./tlf/mock-ae_specific.rtf</span></span>
<span><span class="co">#&gt; 4 ./tlf/mock-ae_specific.rtf</span></span></code></pre></div>
<p>After the plan is updated, we can construct call program. Here we
also provide a global argument for the data source.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/spec_call_program.html">spec_call_program</a></span><span class="op">(</span><span class="va">meta</span>,</span>
<span>  data_source <span class="op">=</span> <span class="st">"[adam-adsl; adae]"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "ae_summary(meta = meta, population = 'apat', observation = 'wk12', parameter = 'any;rel;ser', mockup = TRUE, output_report = './tlf/mock-ae_summary.rtf', data_source = '[adam-adsl; adae]')"</span></span>
<span><span class="co">#&gt; [2] "ae_specific(meta = meta, population = 'apat', observation = 'wk12', parameter = 'any', mockup = TRUE, output_report = './tlf/mock-ae_specific.rtf', data_source = '[adam-adsl; adae]')"      </span></span>
<span><span class="co">#&gt; [3] "ae_specific(meta = meta, population = 'apat', observation = 'wk12', parameter = 'rel', mockup = TRUE, output_report = './tlf/mock-ae_specific.rtf', data_source = '[adam-adsl; adae]')"      </span></span>
<span><span class="co">#&gt; [4] "ae_specific(meta = meta, population = 'apat', observation = 'wk12', parameter = 'ser', mockup = TRUE, output_report = './tlf/mock-ae_specific.rtf', data_source = '[adam-adsl; adae]')"</span></span></code></pre></div>
<p>The pending effort is to define an <code>ae_summary()</code> and an
<code>ae_specific()</code> function that can generate the mock up tables
based on the inputs.</p>
</div>
<div class="section level2">
<h2 id="create-functions">Create functions<a class="anchor" aria-label="anchor" href="#create-functions"></a>
</h2>
<p>Let’s create a simplified version of <code>ae_summary()</code> to
illustrate the idea.</p>
<details><summary>
Click to view the code for function <code>ae_summary()</code>
</summary><div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ae_summary</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">meta</span>,</span>
<span>                       <span class="va">population</span>,</span>
<span>                       <span class="va">observation</span>,</span>
<span>                       <span class="va">parameter</span>,</span>
<span>                       <span class="va">mockup</span>,</span>
<span>                       <span class="va">output_report</span>,</span>
<span>                       <span class="va">data_source</span>,</span>
<span>                       <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Identify parameter keywords</span></span>
<span>  <span class="va">para_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="st">";"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Row label</span></span>
<span>  <span class="va">ae_label</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">para_list</span>,</span>
<span>    FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="../reference/collect_adam_mapping.html">collect_adam_mapping</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">label</span></span>
<span>    <span class="op">}</span>,</span>
<span>    FUN.VALUE <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get treatment grouping order</span></span>
<span>  <span class="va">trt_order</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html" class="external-link">eval</a></span><span class="op">(</span><span class="fu"><a href="../reference/collect_adam_mapping.html">collect_adam_mapping</a></span><span class="op">(</span><span class="va">meta</span>, <span class="va">population</span><span class="op">)</span><span class="op">$</span><span class="va">group_order</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Get the title/endnotes of TLF</span></span>
<span>  <span class="va">title_text</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/collect_title.html">collect_title</a></span><span class="op">(</span></span>
<span>    meta <span class="op">=</span> <span class="va">meta</span>,</span>
<span>    population <span class="op">=</span> <span class="va">population</span>,</span>
<span>    observation <span class="op">=</span> <span class="va">observation</span>,</span>
<span>    parameter <span class="op">=</span> <span class="va">parameter</span>, analysis <span class="op">=</span> <span class="st">"ae_summary"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">title_text</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">"{Week}"</span></span>
<span></span>
<span>  <span class="co"># Logic to create mockup table</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">mockup</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Generate RTF</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      ae_label <span class="op">=</span> <span class="va">ae_label</span>,</span>
<span>      n_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ae_label</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      n_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ae_label</span><span class="op">)</span><span class="op">)</span>, <span class="co"># no display_total/CI</span></span>
<span>      pct_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"x.xx"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ae_label</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      pct_2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"x.xx"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ae_label</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ae_label</span>, <span class="va">n_1</span>, <span class="va">pct_1</span>, <span class="va">n_2</span>, <span class="va">pct_2</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="co"># r2rtf::rtf_title(rtf_mock_color(title_text)) |&gt;</span></span>
<span>      <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_title.html" class="external-link">rtf_title</a></span><span class="op">(</span><span class="va">title_text</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_colheader.html" class="external-link">rtf_colheader</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">" | "</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span>, collapse <span class="op">=</span> <span class="st">" | "</span><span class="op">)</span>, <span class="st">" "</span><span class="op">)</span>,</span>
<span>        col_rel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_colheader.html" class="external-link">rtf_colheader</a></span><span class="op">(</span><span class="st">" | n | (%) | n | (%) "</span>,</span>
<span>        border_top <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"single"</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        border_bottom <span class="op">=</span> <span class="st">"single"</span>,</span>
<span>        border_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"single"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"single"</span>, <span class="st">""</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        col_rel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_body.html" class="external-link">rtf_body</a></span><span class="op">(</span></span>
<span>        col_rel_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        border_left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"single"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"single"</span>, <span class="st">""</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        text_justification <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"c"</span>, <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">trt_order</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_source.html" class="external-link">rtf_source</a></span><span class="op">(</span><span class="va">data_source</span><span class="op">)</span></span>
<span></span>
<span>    <span class="co"># Require r2rtf to use color</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"page"</span><span class="op">)</span><span class="op">$</span><span class="va">use_color</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span>    <span class="co"># Save RTF to a path</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">output_report</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/rtf_encode.html" class="external-link">rtf_encode</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">r2rtf</span><span class="fu">::</span><span class="fu"><a href="https://merck.github.io/r2rtf/reference/write_rtf.html" class="external-link">write_rtf</a></span><span class="op">(</span><span class="va">output_report</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">mockup</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># Logic to perform actual AE summary table.</span></span>
<span>    <span class="co"># Omit here</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">output_report</span></span>
<span><span class="op">}</span></span></code></pre></div>
</details><p>For illustration purposes, we only create mock up table for the first
row.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/meta_run.html">meta_run</a></span><span class="op">(</span><span class="va">meta</span>,</span>
<span>  i <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  data_source <span class="op">=</span> <span class="st">"[adam-adsl; adae]"</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $`ae_summary(meta = meta, population = 'apat', observation = 'wk12', parameter = 'any;rel;ser', mockup = TRUE, output_report = './tlf/mock-ae_summary.rtf', data_source = '[adam-adsl; adae]')`</span></span>
<span><span class="co">#&gt; [1] "./tlf/mock-ae_summary.rtf"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="display-the-generated-mockup-tables">Display the generated mockup tables<a class="anchor" aria-label="anchor" href="#display-the-generated-mockup-tables"></a>
</h2>
<embed src="tlf/mock-ae_summary.pdf" width="100%" height="400px" style="display: block; margin: auto;" type="application/pdf"></embed>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yilong Zhang, Yujie Zhao, Nan Xiao. Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0. <br>Copyright © 2023 Merck &amp; Co., Inc., Rahway, NJ, USA and its affiliates. All rights reserved.</p>
</div>

<div class="pkgdown-footer-right">
  <p><span></span></p>
</div>

    </footer>
</div>





  </body>
</html>
